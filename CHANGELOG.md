# Лог изменений

Лог изменений использует формат [Keep a Changelog](https://keepachangelog.com/ru/1.1.0/).

Репозиторий использует версионирование в формате [Semantic Versioning](https://semver.org/lang/ru/).

## [Новое][unreleased]

### Добавлено

- Поддержка никнеймов игроков с возможностью импорта и экспорта.
- Возможность развернуть список игроков. В этом режиме видны никнеймы игроков, если они установлены.
  - В ландшафтном режиме список игроков всегда развёрнут.
- Визуализация свободных мест на экране случайно рассадки.
- Статистика игроков:
  - количество побед и общее количество игр за каждую роль;
  - фолов за все игры;
  - дисквалификаций;
  - ППК;
  - угаданных мафий в ЛХ;
  - найденных мафий за шерифа;
  - найденных шерифов за дона;
  - смертей в первую ночь.
- Фаза "свободной посадки" ([правило ФИИМ 4.2.4][rules] в редакции от 01.02.2024).
- Состояние "Удалён" при дисквалификации на экране информации об игроке.
- Подсветка членов победившей команды при окончании игры.
- Отображение списка игроков перед повторными речами, между которыми голоса поделились поровну.

### Изменено

- Игра теперь не начинается автоматически.
- Шрифт роли теперь больше, чем номер игрока или никнейм на экране раздачи ролей.
- Кнопки игроков на главном экране теперь расширяемые.
- Улучшен алгоритм подбора ролей для игроков.

### Исправлено

- Дисквалификация любого игрока приводит к неверному просчёту результата игры.
- При дисквалификации теперь не ставится автоматически 4 фола.
- При ППК теперь не ставится дисквалификация всем игрокам команды.
- Таймер теперь не сбрасывается при повороте экрана.
- Загрузка журнала, сохранённого в версии 0.3.0-rc.1, иногда не работала.

### Устарело

- Загрузка журнала игры, созданного в версии 0.3.0-rc.0 и раньше, скоро перестанет поддерживаться.

### Удалено

- Кнопки "Случайная рассадка" и "Раздача ролей" в боковом меню.

[rules]: https://mafiaworldtour.com/fiim-rules

## [v0.3.0-rc.1] - 2024-03-04

### Добавлено

- Корректная поддержка фолов и дисквалификаций.
- Другая иконка и название приложения для отладочных версий.
- Возможность выбрать свой основной цвет приложения.
- Возможность изменить длительность вибрации или отключить её. Полезно для некоторых устройств.
- При повторном нажатии на кнопку сброса на экране выбора ролей, все отметки снимаются.

### Изменено

- Игровой день теперь начинается с фазы "ночи", чтобы соответствовать [правилам ФИИМ][rules].
- Режим таймера по умолчанию теперь "Строгий".
- Версия приложения теперь берётся из git.
- Настройки разделены на категории.

### Исправлено

- При загрузке журнала игры появлялись дублирующиеся записи.
- При ошибке во время загрузки журнала игры не было уведомления.
- Падение приложения при попытке сохранить и сразу загрузить журнал игры.

[rules]: https://mafiaworldtour.com/fiim-rules

## [v0.3.0-rc.0] - 2023-12-01

### Добавлено

- Автоматическая проверка, скачивание и установка обновлений (только для Android).
- Кнопка в настройках для отключения автоматического обновления и для их проверки вручную
  (только для Android).
- Уведомление о новой версии приложения в боковом меню (только для Android).
- Сокращённый вариант таймера. Полезен, если на партию осталось мало времени.
- Отслеживание "Лучшего хода" ([правила][rules] 4.5.9, 7.10, 8.3).
- Возможность выбрать роли, которые могут быть выданы для каждого игрока.
- Кнопка для формирования отчёта об ошибке.
- Возможность сохранить журнал игры в файл и загрузить его.

### Изменено

- Для отмены выдачи предупреждения теперь нужно вернуть состояние игры на один ход назад.
- Иконка приложения изменена со стандартной на более подходящую. Идеи для улучшения иконки
  приветствуются.
- Теперь apk-файлы подписаны личным цифровым сертификатом. Установка этой версии может потребовать
  удаления старой.

### Исправлено

- Если игра неактивна, фолы не выдаются.
- Внутренние исправления и улучшения в коде. Могут появиться неожиданные баги.

### Удалено

- Возможность убрать фол, убить или воскресить игрока вручную. Это могло сломать игру или привести
  её в неожиданное состояние, и по факту требовалось только при отладке или в специфичных случаях.

[rules]: https://mafiaworldtour.com/fiim-rules

## [v0.2.0-rc.1] - 2023-10-28

### Добавлено

- Долгое нажатие на "+" или "-" при голосовании увеличит количество голосов до максимума или
  до минимума соответственно.
- Реализованы [правила][rules] 4.4.12.2 и 7.8.
- Возможность посмотреть зерно генерации пользователей. Если приложение собрано в режиме отладки,
  то доступна возможность редактирования.

### Изменено

- Кнопки быстрых действий (кроме перезапуска) перенесены в отдельное меню.

### Исправлено

- "Предупреждение" переименовано в "фол", чтобы соответствовать терминологии [правил ФИИМ][rules].
- Исправлен редкий баг, когда игра не давала всем игрокам возможность говорить в фазу дня.

[rules]: https://mafiaworldtour.com/fiim-rules

## [v0.2.0-rc.0] - 2023-08-14

### Добавлено

- Журнал игры.
- Поддержка ландшафтной ориентации экрана.
- Журнал изменений приложения в формате Keep a Changelog.

### Изменено

- Теперь при выдаче предупреждения запрашивается подтверждение в диалоговом окне, кнопка отмены
  на всплывающем уведомлении убрана.

### Исправлено

- Мафия не подсвечивалась как активная после смерти.
- Внутренние улучшения в коде.

## [v0.2.0-beta.2] - 2023-06-23

### Добавлено

- Экран случайной рассадки игроков.
- Тема приложения теперь сочетается с системной темой на поддерживаемых платформах, в частности,
  Android 12+.
- Эмодзи "палец вверх/вниз" в текст результата при проверке шерифом.
- Подтверждение выхода при активной игре.

### Исправлено

- Улучшены правила форматирования кода.
- Баг с невозможностью отменить выбор игрока.
- Внутренние улучшения в коде.
- Некоторые части приложения могли остаться на английском языке.

## [v0.2.0-beta.1] - 2023-06-02

### Добавлено

- Кнопка для очистки заметок.

### Исправлено

- Улучшена обработка ситуации "подъёма стола".
- Выдача предупреждений не тому игроку.

## [v0.2.0-beta.0] - 2023-06-01

### Добавлено

- Отслеживание ничейного состояния игры.
- Возможность писать заметки во время игры.

### Изменено

- Описание при голосовании за "поднятие стола".

### Удалено

- Переключатель отката состояния в настройках, так как после внутренних улучшений функция работает
  намного стабильнее.

### Исправлено

- Внутренние улучшения в коде управления состояниями.
- Комиссар переименован в Шерифа согласно правилам ФИИМ.
- Мёртвый шериф и дон не могут делать проверки.

## [v0.1.0-beta.3] - 2023-05-18

### Исправлено

- Игра "зависала", когда на голосовании выставлен только один игрок
- Игра не завершалась при победе мафии

## [v0.1.0-beta.2] - 2023-05-14

### Добавлено

- Возможность вручную снять предупреждение, убить или воскресить игрока.

## [v0.1.0-beta.1] - 2023-05-14

### Добавлено

- Вибрация, когда таймер заканчивается.
- Крайне экспериментальная функция возврата состояния.
- Экран настроек: настройка таймера, темы, переключатель экспериментального возврата состояния.
- Боковое меню.
- Информация о приложении.
- Ссылка на официальные правила игры от ФИИМ.
- Базовая поддержка предупреждений, никак не влияют на игру.

### Изменено

- Цветовая схема кнопок игроков.
- Код обновлён до Dart 3.

### Исправлено

- "Зависшая" полупрозрачность при перезапуске таймера.
- Игроки теперь убиваются после последних слов.
- "Предсказание" результата голосования.
- Умный максимум игроков для голосования.

## [v0.1.0-beta.0] - 2023-05-04

### Добавлено

- Отображение порядка голосования.
- Сборка и публикация приложения для Web с помощью GitHub Actions.

### Изменено

- Обновлено поведение и тексты в соответствии с правилами ФИИМ.
- Суффикс дона возле номера с "Д" на "ДМ".
- Удалена неиспользуемая директория для сборки на платформе Linux. Сборки для Linux
  не поддерживались и не тестировались.

### Исправлено

- Различные исправления и улучшения исходного кода.

## [v0.1.0-alpha.1] - 2023-04-21

### Добавлено

- Результат проверки дона и комиссара при нажатии на игрока.
- Отдельный метод API для отмены выбора всех игроков.

### Изменено

- Ограничена возможность выбирать игроков, если они не выставляются и сейчас не ночь.
- Один игрок теперь может выставить не более одного игрока, а мафия — убить не более одного.

## [v0.1.0-alpha.0] - 2023-04-21

### Добавлено

- Реализованы базовые правила игры.
- Предугадывание следующего этапа игры.
- Случайная генерация ролей для игроков.
- Экран раздачи ролей на основе случайной генерации.
- Отслеживание состояния игры: роли, живые, мёртвые и выставленные на голосование игроки,
  активный игрок, игровой таймер.
- Кнопка для показа ролей рядом с номерами игроков.
- "Предсказание" результата голосования.
- Больше информации об игроке при долгом нажатии на номер.
- Автоматическая сборка при помощи GitHub Actions.

[unreleased]: https://github.com/evgfilim1/mafia-companion/compare/v0.3.0-rc.1...HEAD
[v0.3.0-rc.1]: https://github.com/evgfilim1/mafia-companion/releases/tag/v0.3.0-rc.1
[v0.3.0-rc.0]: https://github.com/evgfilim1/mafia-companion/releases/tag/v0.3.0-rc.0
[v0.2.0-rc.1]: https://github.com/evgfilim1/mafia-companion/releases/tag/v0.2.0-rc.1
[v0.2.0-rc.0]: https://github.com/evgfilim1/mafia-companion/releases/tag/v0.2.0-rc.0
[v0.2.0-beta.2]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.2.0-beta.2
[v0.2.0-beta.1]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.2.0-beta.1
[v0.2.0-beta.0]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.2.0-beta.0
[v0.1.0-beta.3]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-beta.3
[v0.1.0-beta.2]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-beta.2
[v0.1.0-beta.1]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-beta.1
[v0.1.0-beta.0]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-beta.0
[v0.1.0-alpha.1]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-alpha.1
[v0.1.0-alpha.0]: https://github.com/evgfilim1/mafia-companion/releases/tag/0.1.0-alpha.0
